---
layout: ../../../layouts/PostLayout.astro
title: Making an Embedded Rust Driver on the STM32 bluepill
hero: ./Background.jpg
thumbnail: ./Thumbnail.png
description: How i designed an 
tags: [ rust, embedded, stm32, microcontrollers ]
date: 01-01-2022
draft: true
---

import Signup from '../../../components/Signup.astro';


# Designing an embedded device driver with rust on the STM32 Bluepill

![Ferris on an MCU](/assets/embedded-driver-in-rust/Background.jpg)

Recently i've using rust for around the last few month's and I've really been enjoying it. A lot of my day to day work consists of writing device drivers for various hardware/software platforms. I've been really wanting to take a stab at writing these in rust, since most of the time i am using C/C++.  

I've got a few ADXL343's laying around so i thought maybeI'll just give this a go on my own and I'd write up my efforts in the event that anyone else was in a similar situation. There's an existing library [](https://docs.rs/adxl343/latest/adxl343/) already so by no means am I endorsing anyone to use this code, but feel free to follow along.

For anyone unfamiliar with embedded development most drivers consist of methods of configuring certain registers in a device which will then cause the device to behave in a specific way. The *ADXL343* is no different. The deivce does have interrupts which we will go over in a separate post.

The devices communicate with something called a peripheral these come in many different shapes and sizes but the most common are undoubtedly UART/I2C/SPI. One somewhat unique feature of the *ADXL343* although not uncommon is that it can be used with either SPI or I2C communication interfaces. We may use this to our advantage later to explore how we can use traits to provide generic interfaces to a device.


We will start off with a naive but full featured way of writing this driver and then move on from there to a gradually more refined driver interface.

We will be doing this exercise on an STM32 bluepill because well, I have them laying around, they're cheap, and I mostly do work with STM32 mcu's. They are fairly popular in terms of microcontroller's so setting up a project is well documented. We won't go through all of the motany of the the setup procedure we'll save that for a later time. 

Without further ado let's get started. Fire up your terminal and follow along.

### Setup

### Setup

I am going to use the SPI interface of the *ADXL343*.

#### Wiring
#### Project Setup - Cargo

```rust
fn main() {
}
```

[Another article on setting up cargo](https://jonathanklimt.de/electronics/programming/embedded-rust/rust-on-stm32-2/)

```bash
$ rustup update
$ rustup target install thumbv7m-none-eabi
$ cargo install cargo-flash
$ cargo init rusty-blink
$ cargo add cortex-m cortex-m-rt
```


<Signup />


